buildscript{
    ext.kotlin_version = "1.3.40"
    
    repositories{
        jcenter()
        mavenCentral()
        
        maven{
            url = "http://files.minecraftforge.net/maven"
        }
    }
    
    dependencies{
        classpath "net.minecraftforge.gradle:ForgeGradle:2.3-SNAPSHOT"
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:${kotlin_version}"
    }
}

apply plugin: "net.minecraftforge.gradle.forge"
apply plugin: "kotlin"

sourceCompatibility = targetCompatibility = "1.8"

tasks.withType(JavaCompile){
    sourceCompatibility = targetCompatibility = "1.8"
}

tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile){
    kotlinOptions{
        jvmTarget = "1.8"
        apiVersion = "1.3"
        languageVersion = "1.3"
        freeCompilerArgs = [
            "-Xjvm-default=enable",
            "-Xuse-experimental=kotlin.ExperimentalUnsignedTypes",
            "-Xuse-experimental=kotlin.contracts.ExperimentalContracts",
            "-XXLanguage:+InlineClasses"
        ]
    }
}

minecraft{
    version = "1.12.2-14.23.5.2768"
    runDir = "run"
    mappings = "stable_39"
    makeObfSourceJar = false
}

dependencies{
    compile "org.jetbrains.kotlin:kotlin-stdlib-jdk8"
    compile "org.jetbrains.kotlin:kotlin-reflect"

    testCompile "org.junit.jupiter:junit-jupiter-api:5.3.0-RC1"
}

test{
    systemProperty "junit.jupiter.testinstance.lifecycle.default", "per_class"
}

def modinfo = null

processResources{
    File file = new File(++sourceSets.main.resources.srcDirs.iterator(), "mcmod.info")
    modinfo = new groovy.json.JsonSlurper().parseText(file.getText())[0]

    rename("hee_at.cfg", "META-INF/hee_at.cfg")
}

jar{
    archiveName = "HardcoreEnderExpansion  MC-${project.minecraft.version}  v${modinfo.version}.jar"

    manifest{
        attributes "FMLAT": "hee_at.cfg"
    }
}
